<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ç ”ç©¶æ”¯æ´ãƒãƒ£ãƒƒãƒˆ</title>
  <style>
    /* masaaki.html ã‹ã‚‰ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ã‚³ãƒ”ãƒ¼ */
    body { font-family: sans-serif; margin:20px; }
    h1, h2 { color: #333; }
    textarea { width: 100%; max-width: 600px; padding: 8px; border-radius: 6px; border: 1px solid #ccc; }
    button { padding: 10px 16px; background-color: #007bff; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 1em; }
    button:hover { background-color: #0056b3; }
    #loading { display: none; margin-top: 10px; }

    /* ã‚«ãƒ¼ãƒ‰ã‚³ãƒ³ãƒ†ãƒŠã‚’ç¸¦ã«ä¸¦ã¹ã‚‹ */
    .cards { display: flex; flex-direction: column; gap: 16px; margin-top: 20px; }

    /* æ¨ªé•·ã‚«ãƒ¼ãƒ‰ */
    .card { 
      display: flex; 
      justify-content: space-between;
      background:#fff; 
      border-radius:12px; 
      padding:16px; 
      box-shadow:0 2px 6px rgba(0,0,0,0.1);
    }

    /* å·¦å´ã®ãƒ†ã‚­ã‚¹ãƒˆ */
    .card .info { flex: 1; }
    .card .info h2 { 
      margin:0 0 8px; 
      font-size:1.3em; 
      font-weight:700; 
      color:#333;
    }
    .card .place { font-size:1em; font-weight:600; color:#007bff; margin-bottom:8px; }
    .card .use { font-size:0.90em; color:#555; margin-bottom:8px; }
    .card .article { font-size:1em; font-style:italic; color:#444; margin-bottom:6px; }

    /* å³å´ãƒªãƒ³ã‚¯ */
    .card .link { margin-left: 20px; white-space: nowrap; display:flex; align-items:center; }
    .card .link a { text-decoration:none; color:#007bff; }
  </style>
</head>
<body>
  <h1>ç ”ç©¶æ”¯æ´ãƒãƒ£ãƒƒãƒˆ ğŸ”¬</h1>
  <p>ã‚„ã‚ŠãŸã„ã“ã¨ã‚’å…¥åŠ›ã™ã‚‹ã¨ã€ç ”ç©¶å®¤ã«ã‚ã‚‹æœ€é©ãªãƒ‡ãƒã‚¤ã‚¹ã‚’ææ¡ˆã—ã¾ã™ã€‚</p>

  <textarea id="userInput" rows="4" cols="50" placeholder="ä¾‹:ã€Œãƒã‚¤ã‚¯ãƒ­æµè·¯å†…ã®å¾®å°ãªç²’å­ã®å‹•ãã‚’é«˜é€Ÿã§æ’®å½±ã—ãŸã„ã€"></textarea><br><br>
  <button onclick="sendMessage()">é€ä¿¡</button>
  <div id="loading">æ¤œç´¢ä¸­...</div>

  <h2>ææ¡ˆã•ã‚ŒãŸãƒ‡ãƒã‚¤ã‚¹:</h2>
  <div id="cardsContainer" class="cards"></div>

  <script>
    // masaaki.html ã‹ã‚‰ã‚«ãƒ¼ãƒ‰ç”Ÿæˆé–¢æ•°ã‚’ã‚³ãƒ”ãƒ¼
    function createCard(d) {
      const div = document.createElement('div');
      div.className = 'card';
      div.innerHTML = `
        <div class="info">
          <h2>${d.name || ''}</h2>
          <div class="place"><b>é…ç½®å ´æ‰€ï¼š</b>${d.place || 'æƒ…å ±ãªã—'}</div>
          <div class="use"><b>èª¬æ˜ï¼š</b>${d.use || 'æƒ…å ±ãªã—'}</div>
          <div class="article"><b>ä½¿ç”¨ã•ã‚ŒãŸè«–æ–‡ï¼š</b>${d.article || 'æƒ…å ±ãªã—'}</div>
        </div>
        <div class="link">
          ${d.articleUrl ? `<a href="${d.articleUrl}" target="_blank">è¨˜äº‹ãƒªãƒ³ã‚¯</a>` : ''}
          <div style="font-size:0.75em;color:#aaa;margin-left:10px;">ID: ${d.id || ''}</div>
        </div>
      `;
      return div;
    }

    async function sendMessage() {
      const userMessage = document.getElementById("userInput").value;
      const container = document.getElementById('cardsContainer');
      const loadingIndicator = document.getElementById('loading');
      
      if (!userMessage.trim()) {
        alert('è³ªå•ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
        return;
      }

      // ä»¥å‰ã®çµæœã‚’ã‚¯ãƒªã‚¢ã—ã€ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
      container.innerHTML = '';
      loadingIndicator.style.display = 'block';

      try {
        const res = await fetch("/search/chat", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message: userMessage })
        });

        if (!res.ok) {
          throw new Error(`ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼: ${res.status}`);
        }

        // ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¯ãƒ‡ãƒã‚¤ã‚¹æƒ…å ±ã®é…åˆ—
        const devices = await res.json();
        
        if (devices.error) {
            container.innerText = `ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${devices.error}`;
        } else if (devices.length === 0) {
            container.innerText = 'é–¢é€£ã™ã‚‹ãƒ‡ãƒã‚¤ã‚¹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚';
        } else {
            // å—ã‘å–ã£ãŸãƒ‡ãƒã‚¤ã‚¹ãƒ‡ãƒ¼ã‚¿ã§ã‚«ãƒ¼ãƒ‰ã‚’ç”Ÿæˆ
            devices.forEach(device => {
              const cardElement = createCard(device);
              container.appendChild(cardElement);
            });
        }
      } catch (error) {
        console.error("Fetch Error:", error);
        container.innerText = 'ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚';
      } finally {
        // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°éè¡¨ç¤º
        loadingIndicator.style.display = 'none';
      }
    }
  </script>
</body>
</html>