<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <title>研究室 備品管理</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style_resist.css') }}">
</head>
<body>
  <header class="navbar">
    <h1>研究室 備品管理システム</h1>
  </header>

  <main class="container">
    <!-- 追加フォーム -->
    <div class="card">
      <h2>備品を追加</h2>
      <form onsubmit="event.preventDefault(); addAsset();">
        <label>デバイス名 *</label>
        <input id="name" required>

        <label>場所 *</label>
        <input id="place" required>

        <label>使い方 *</label>
        <textarea id="use" required></textarea>

        <label>論文タイトル</label>
        <input id="article">

        <label>論文URL</label>
        <input id="articleUrl" type="url">

        <label>ジャンル *</label>
        <div class="genre-options">
          <label><input type="checkbox" name="genre" value="digital well-being"><span>Digital Well-being</span></label>
          <label><input type="checkbox" name="genre" value="XR"><span>XR</span></label>
          <label><input type="checkbox" name="genre" value="daily well-being"><span>Daily Well-being</span></label>
          <label><input type="checkbox" name="genre" value="physical activity"><span>Physical Activity</span></label>
        </div>

        <button type="submit" class="btn-primary">追加</button>
      </form>
      <div id="addMsg"></div>
    </div>

    <!-- 削除フォーム -->
    <div class="card">
      <h2>備品を削除</h2>
      <form onsubmit="event.preventDefault(); deleteAsset();">
        <label>デバイス名 *</label>
        <input id="delName" required>
        <button type="submit" class="btn-danger">削除</button>
      </form>
      <div id="delMsg"></div>
    </div>
  </main>

<script>
const API_BASE = "http://127.0.0.1:5000";

async function addAsset() {
  const selectedGenres = Array.from(document.querySelectorAll("input[name='genre']:checked"))
                              .map(el => el.value);

  const data = {
    name: document.getElementById("name").value,
    place: document.getElementById("place").value,
    use: document.getElementById("use").value,
    article: document.getElementById("article").value,
    articleUrl: document.getElementById("articleUrl").value,
    genres: selectedGenres
  };

  const res = await fetch(`${API_BASE}/add_asset`, {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify(data)
  });
  const result = await res.json();
  const msgBox = document.getElementById("addMsg");
  msgBox.innerHTML = result.message;
  msgBox.className = "msg " + (result.status === "success" ? "success":"error");
}

async function deleteAsset() {
  const data = { name: document.getElementById("delName").value };
  const res = await fetch(`${API_BASE}/delete_asset`, {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify(data)
  });
  const result = await res.json();
  const msgBox = document.getElementById("delMsg");
  msgBox.innerHTML = result.message;
  msgBox.className = "msg " + (result.status === "success" ? "success":"error");
}
</script>
</body>
</html>
