<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <title>研究室 備品管理</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style_resist.css') }}">
</head>
<style>
  /* ▼▼▼【追加】サイドバーのロゴのスタイル ▼▼▼ */
  .sidebar-logo {
    display: block;      /* 中央揃えのためにblock要素にする */
    width: 80%;          /* サイドバーの幅に対して80%のサイズ */
    max-width: 150px;    /* 大きくなりすぎないように最大幅を指定 */
    margin: 20px auto;   /* 上下に20px、左右に自動でマージンをとり中央揃え */
    padding-bottom: 20px; /* ロゴの下に余白を追加 */
    border-bottom: 1px solid #eee; /* 区切り線 */
  }
  /* ▲▲▲【追加】サイドバーのロゴのスタイル ▲▲▲ */
</style>
<body>
  
  <header class="navbar">
    <h1>研究室 備品管理システム</h1>
  </header>
  <div class="layout">  
    <aside class="sidebar">
      <img src="{{ url_for('static', filename='Lopezn.png') }}" alt="Lopezon Logo" class="sidebar-logo">
      {% include "sidebar.html" %}
    </aside>

    <main class="container">
      <!-- 追加フォーム -->
      <div class="card">
        <h2>備品を追加</h2>
        <form onsubmit="event.preventDefault(); addAsset();">
          <label>デバイス名 *</label>
          <input id="name" required>

          <!-- 以下比留間編集 「場所」をプルダウンメニューに変更-->
          <label>場所 *</label>
          <select id="place" required>
            <option value="" disabled selected>場所を選択してください</option>
            <option value="棚・左・１段目">棚・左・１段目</option>
            <option value="棚・左・２段目">棚・左・２段目</option>
            <option value="棚・左・３段目">棚・左・３段目</option>
            <option value="棚・真ん中・１段目">棚・真ん中・１段目</option>
            <option value="棚・真ん中・２段目">棚・真ん中・２段目</option>
            <option value="棚・真ん中・３段目">棚・真ん中・３段目</option>
            <option value="棚・真ん中・４段目">棚・真ん中・４段目</option>
            <option value="棚・真ん中・５段目">棚・真ん中・５段目</option>
            <option value="棚・真ん中・６段目">棚・真ん中・６段目</option>
            <option value="棚・右・１段目">棚・右・１段目</option>
            <option value="棚・右・２段目">棚・右・２段目</option>
            <option value="棚・右・３段目">棚・右・３段目</option>
            <option value="棚・右・４段目">棚・右・４段目</option>
            <option value="LopezLab下・机">LopezLab下・机</option>
            <option value="その他">その他</option>
          </select>
          <!-- ここまで比留間編集 -->

          <label>使い方 *</label>
          <textarea id="use" required></textarea>

          <label>論文タイトル</label>
          <input id="article">

          <label>論文URL</label>
          <input id="articleUrl" type="url">

          <label>ジャンル *</label>
          <div class="genre-options">
            <label><input type="checkbox" name="genre" value="digital well-being"><span>Digital Well-being</span></label>
            <label><input type="checkbox" name="genre" value="XR"><span>XR</span></label>
            <label><input type="checkbox" name="genre" value="daily well-being"><span>Daily Well-being</span></label>
            <label><input type="checkbox" name="genre" value="physical activity"><span>Physical Activity</span></label>
          </div>

          <button type="submit" class="btn-primary">追加</button>
        </form>
        <div id="addMsg"></div>
      </div>

      <!-- 削除フォーム -->
      <div class="card">
        <h2>備品を削除</h2>
        <form onsubmit="event.preventDefault(); deleteAsset();">
          <label>デバイス名 *</label>
          <input id="delName" required>
          <button type="submit" class="btn-danger">削除</button>
        </form>
        <div id="delMsg"></div>
      </div>
    </main>

  </div>
  

<script>
const API_BASE = "http://127.0.0.1:5000";

async function addAsset() {
  const selectedGenres = Array.from(document.querySelectorAll("input[name='genre']:checked"))
                              .map(el => el.value);

  const data = {
    name: document.getElementById("name").value,
    place: document.getElementById("place").value,
    use: document.getElementById("use").value,
    article: document.getElementById("article").value,
    articleUrl: document.getElementById("articleUrl").value,
    genres: selectedGenres
  };

  const res = await fetch(`${API_BASE}/matsuda/add_asset`, {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify(data)
  });
  const result = await res.json();
  const msgBox = document.getElementById("addMsg");
  msgBox.innerHTML = result.message;
  msgBox.className = "msg " + (result.status === "success" ? "success":"error");


  //以下比留間追記（デバイス新規登録した際に、入力フォームがリセットされる＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊
  if(result.status === "success"){
    document.getElementById("name").value = "";
    document.getElementById("place").value = "";
    document.getElementById("use").value = "";
    document.getElementById("article").value = "";
    document.getElementById("articleUrl").value = "";


    document.querySelectorAll("input[name='genre']").forEach(checkbox => {
      checkbox.checked = false;
    });
  }
  //ここまで比留間追記＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊
}

async function deleteAsset() {
  const data = { name: document.getElementById("delName").value };
  const res = await fetch(`${API_BASE}/delete_asset`, {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify(data)
  });
  const result = await res.json();
  const msgBox = document.getElementById("delMsg");
  msgBox.innerHTML = result.message;
  msgBox.className = "msg " + (result.status === "success" ? "success":"error");
}
</script>
</body>
</html>
